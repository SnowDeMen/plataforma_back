# Diagramas de Arquitectura

## Diagrama de Capas

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     CAPA DE PRESENTACIรN                     โ
โ                        (app/api/)                            โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ Endpoints  โ  โMiddlewares โ  โ   Dependencies       โ  โ
โ  โ   REST     โ  โ            โ  โ   (Inyecciรณn)        โ  โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CAPA DE APLICACIรN                        โ
โ                    (app/application/)                        โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  Casos de  โ  โ    DTOs    โ  โ     Interfaces       โ  โ
โ  โ    Uso     โ  โ            โ  โ                      โ  โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE DOMINIO                         โ
โ                      (app/domain/)                           โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ Entidades  โ  โRepositoriosโ  โ     Servicios        โ  โ
โ  โ            โ  โ(Interfaces)โ  โ     de Dominio       โ  โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  CAPA DE INFRAESTRUCTURA                     โ
โ                  (app/infrastructure/)                       โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  Database  โ  โRepositoriosโ  โ      AutoGen         โ  โ
โ  โ  (SQLite/  โ  โ   (Impl)   โ  โ    Integration       โ  โ
โ  โPostgreSQL) โ  โ            โ  โ                      โ  โ
โ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Flujo de una Peticiรณn HTTP

```
1. Cliente HTTP
      โ
2. FastAPI Router (app/api/v1/router.py)
      โ
3. Endpoint (app/api/v1/endpoints/agents.py)
      โ
4. Inyecciรณn de Dependencias (app/api/v1/dependencies/)
      โ
5. Caso de Uso (app/application/use_cases/agent_use_cases.py)
      โ
6. Entidad de Dominio (app/domain/entities/agent.py)
      โ
7. Repositorio (Interfaz) (app/domain/repositories/agent_repository.py)
      โ
8. Repositorio (Implementaciรณn) (app/infrastructure/repositories/agent_repository_impl.py)
      โ
9. Base de Datos (SQLAlchemy + SQLite/PostgreSQL)
      โ
10. Respuesta (DTO) โ Cliente
```

## Diagrama de Componentes

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          FRONTEND REACT                          โ
โ                     (Aplicaciรณn Web Cliente)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ HTTP/REST
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         BACKEND FASTAPI                          โ
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                     API REST (v1)                         โ  โ
โ  โ  โข POST   /api/v1/agents/                                โ  โ
โ  โ  โข GET    /api/v1/agents/{id}                            โ  โ
โ  โ  โข GET    /api/v1/agents/                                โ  โ
โ  โ  โข PUT    /api/v1/agents/{id}                            โ  โ
โ  โ  โข DELETE /api/v1/agents/{id}                            โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                              โ                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              Lรณgica de Aplicaciรณn                        โ  โ
โ  โ  โข AgentUseCases                                         โ  โ
โ  โ  โข ConversationUseCases (futuro)                         โ  โ
โ  โ  โข TrainingUseCases (futuro)                             โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                              โ                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              Lรณgica de Dominio                           โ  โ
โ  โ  โข Agent Entity                                          โ  โ
โ  โ  โข Conversation Entity                                   โ  โ
โ  โ  โข Business Rules                                        โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                              โ                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              Infraestructura                             โ  โ
โ  โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  Database   โ  โ   AutoGen    โ  โ   External    โ  โ  โ
โ  โ  โ             โ  โ  Integration โ  โ   Services    โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโ  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ                    โ                      โ
    โโโโโโโโโโโโ         โโโโโโโโโโโโ          โโโโโโโโโโโโ
    โ Database โ         โ  OpenAI  โ          โ   APIs   โ
    โ  SQLite/ โ         โ   API    โ          โ Externas โ
    โPostgreSQLโ         โโโโโโโโโโโโ          โโโโโโโโโโโโ
    โโโโโโโโโโโโ
```

## Diagrama de Dependencias (SOLID)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Dependency Inversion                      โ
โ                                                              โ
โ  โโโโโโโโโโโโโโโโโโโโ                                       โ
โ  โ  AgentUseCases   โ  (Depende de abstracciรณn)             โ
โ  โโโโโโโโโโฌโโโโโโโโโโ                                       โ
โ           โ                                                  โ
โ           โ (usa interfaz)                                   โ
โ  โโโโโโโโโโโโโโโโโโโโ                                       โ
โ  โ IAgentRepository โ  (Interfaz/Contrato)                  โ
โ  โโโโโโโโโโฌโโโโโโโโโโ                                       โ
โ           โ (implementa)                                     โ
โ           โ                                                  โ
โ  โโโโโโโโโโดโโโโโโโโโโโโโโ                                   โ
โ  โAgentRepositoryImpl   โ  (Implementaciรณn concreta)        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโ                                   โ
โ                                                              โ
โ  Beneficio: Se puede cambiar la implementaciรณn sin          โ
โ  afectar los casos de uso (ej: SQLite โ PostgreSQL)         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Diagrama de Entidades (Dominio)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        Agent                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ - id: int                                                โ
โ - name: str                                              โ
โ - type: AgentType                                        โ
โ - status: AgentStatus                                    โ
โ - configuration: Dict                                    โ
โ - system_message: str                                    โ
โ - created_at: datetime                                   โ
โ - updated_at: datetime                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ + activate()                                             โ
โ + pause()                                                โ
โ + complete()                                             โ
โ + set_error()                                            โ
โ + reset()                                                โ
โ + update_configuration(config)                           โ
โ + is_active(): bool                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                       โ participa en
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Conversation                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ - id: int                                                โ
โ - title: str                                             โ
โ - status: ConversationStatus                             โ
โ - agent_ids: List[int]                                   โ
โ - messages: List[Message]                                โ
โ - metadata: Dict                                         โ
โ - created_at: datetime                                   โ
โ - completed_at: datetime                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ + add_message(sender, content)                           โ
โ + complete()                                             โ
โ + cancel()                                               โ
โ + set_error()                                            โ
โ + get_message_count(): int                               โ
โ + is_active(): bool                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Diagrama de Secuencia: Crear un Agente

```
Cliente    Endpoint    UseCases    Repository    Database
  โ           โ            โ            โ            โ
  โโโPOSTโโโโโโ            โ            โ            โ
  โ           โ            โ            โ            โ
  โ           โโโcreateโโโโโ            โ            โ
  โ           โ   (DTO)    โ            โ            โ
  โ           โ            โ            โ            โ
  โ           โ            โโโvalidateโโโ            โ
  โ           โ            โ            โ            โ
  โ           โ            โโโcreateโโโโโ            โ
  โ           โ            โ  (Entity)  โ            โ
  โ           โ            โ            โ            โ
  โ           โ            โ            โโโINSERTโโโโโ
  โ           โ            โ            โ            โ
  โ           โ            โ            โโโโresultโโโโ
  โ           โ            โ            โ            โ
  โ           โ            โโโโAgentโโโโโ            โ
  โ           โ            โ            โ            โ
  โ           โโโโDTOโโโโโโโ            โ            โ
  โ           โ            โ            โ            โ
  โโโโJSONโโโโโ            โ            โ            โ
  โ  (201)    โ            โ            โ            โ
```

## Diagrama de Mรณdulos

```
app/
โโโ api/                    # ๐ Presentaciรณn
โ   โโโ v1/
โ   โ   โโโ endpoints/      # Controladores REST
โ   โ   โโโ dependencies/   # Inyecciรณn de dependencias
โ   โโโ middlewares/        # Procesamiento de requests
โ
โโโ application/            # ๐ฏ Aplicaciรณn
โ   โโโ use_cases/          # Orquestaciรณn de lรณgica
โ   โโโ dto/                # Data Transfer Objects
โ   โโโ interfaces/         # Contratos de servicios
โ
โโโ domain/                 # ๐ Dominio (Nรบcleo)
โ   โโโ entities/           # Objetos de negocio
โ   โโโ repositories/       # Interfaces de persistencia
โ   โโโ services/           # Lรณgica de negocio compleja
โ
โโโ infrastructure/         # ๐ง Infraestructura
โ   โโโ database/           # ORM y configuraciรณn DB
โ   โโโ repositories/       # Implementaciones concretas
โ   โโโ autogen/            # Integraciรณn AutoGen
โ   โโโ external/           # Servicios externos
โ
โโโ core/                   # โ๏ธ Configuraciรณn
โ   โโโ config.py           # Settings
โ   โโโ security.py         # Auth & Security
โ   โโโ events.py           # Startup/Shutdown
โ
โโโ shared/                 # ๐ฆ Compartido
    โโโ exceptions/         # Excepciones custom
    โโโ utils/              # Utilidades
    โโโ constants/          # Constantes
```

## Principios SOLID Visualizados

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  S - Single Responsibility Principle                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ AgentEntity: Solo lรณgica de agentes                 โ
โ  โ AgentRepository: Solo persistencia                  โ
โ  โ AgentUseCases: Solo orquestaciรณn                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  O - Open/Closed Principle                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ Nuevos casos de uso sin modificar existentes        โ
โ  โ Nuevas implementaciones de repositorio              โ
โ  โ Extensiรณn mediante interfaces                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  L - Liskov Substitution Principle                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ Cualquier IAgentRepository es intercambiable        โ
โ  โ SQLiteRepo โ PostgreSQLRepo sin cambios            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  I - Interface Segregation Principle                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ Interfaces especรญficas y pequeรฑas                   โ
โ  โ No mรฉtodos innecesarios                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  D - Dependency Inversion Principle                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ Dependencias hacia abstracciones                    โ
โ  โ UseCases โ IRepository (no implementaciรณn)          โ
โ  โ Inyecciรณn de dependencias con FastAPI               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Flujo de Testing

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Tests Unitarios                        โ
โ  โข Entidades de dominio (sin dependencias)               โ
โ  โข Lรณgica de negocio pura                                โ
โ  โข Rรกpidos y aislados                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  Tests de Integraciรณn                     โ
โ  โข Repositorios + Base de datos en memoria               โ
โ  โข Casos de uso + Repositorios                           โ
โ  โข Verifican interacciรณn entre capas                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     Tests E2E                             โ
โ  โข API completa (endpoints)                              โ
โ  โข Flujos completos de usuario                           โ
โ  โข Simulan cliente real                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

